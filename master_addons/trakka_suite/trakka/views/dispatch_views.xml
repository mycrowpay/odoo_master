<odoo>
  <!-- Action + Menu -->
  <record id="action_trakka_dispatch_orders" model="ir.actions.act_window">
    <field name="name">Dispatch Orders</field>
    <field name="res_model">trakka.dispatch.order</field>
    <field name="view_mode">tree,form</field>
  </record>

  <menuitem id="menu_trakka_dispatch_orders"
            parent="trakka.menu_trakka_ops_root"
            action="trakka.action_trakka_dispatch_orders"
            sequence="20"/>

  <!-- Tree View -->
  <record id="view_trakka_dispatch_tree" model="ir.ui.view">
    <field name="name">trakka.dispatch.order.tree</field>
    <field name="model">trakka.dispatch.order</field>
    <field name="arch" type="xml">
      <tree>
        <field name="name"/>
        <field name="sale_order_id"/>
        <field name="assigned_partner_id"/>
        <field name="state"/>
        <field name="quoted_fee"/>
      </tree>
    </field>
  </record>

  <!-- Form View (v17: use modifiers, include company_id for domain validation) -->
  <record id="view_trakka_dispatch_form" model="ir.ui.view">
    <field name="name">trakka.dispatch.order.form</field>
    <field name="model">trakka.dispatch.order</field>
    <field name="arch" type="xml">
      <form>
        <header>
          <button name="action_assign"
                  type="object"
                  string="Assign"
                  modifiers="{'invisible': [('state','!=','new')]}"/>

          <button name="action_accept"
                  type="object"
                  string="Accept"
                  modifiers="{'invisible': [('state','!=','assigned')]}"/>

          <button name="action_pick"
                  type="object"
                  string="Picked"
                  modifiers="{'invisible': [('state','not in',['accepted','assigned'])]}"/>

          <button name="action_on_route"
                  type="object"
                  string="On Route"
                  modifiers="{'invisible': [('state','!=','picked')]}"/>

          <button name="action_delivered"
                  type="object"
                  string="Delivered"
                  class="oe_highlight"
                  modifiers="{'invisible': [('state','not in',['on_route','picked','accepted'])]}"/>

          <field name="state" widget="statusbar"/>
        </header>

        <sheet>
          <group>
            <!-- Needed because sale_order_id has check_company=True -->
            <field name="company_id" readonly="1" modifiers="{'invisible': true}"/>

            <field name="name" readonly="1"/>
            <field name="sale_order_id"/>
            <field name="assigned_partner_id"/>
            <field name="provider_type"/>
            <field name="buyer_name"/>
            <field name="buyer_phone"/>
            <field name="pickup_address"/>
            <field name="dropoff_address"/>
            <field name="distance_km"/>
            <field name="weight_kg"/>
            <field name="quoted_fee" readonly="1"/>
            <field name="proof_type"/>
            <field name="proof_value"/>
            <field name="delivered_at" readonly="1"
                   modifiers="{'invisible': [('state','!=','delivered')]}"/>
          </group>
        </sheet>
        <chatter/>
      </form>
    </field>
  </record>
</odoo>
